# Half-Close
  
  tcp에서 연결 종료과정에 사용되는 기법이다.
  
  
## 일방적인 연결 종료의 문제점
  
  호스트 A가 마지막 데이터를 전송하고 나서 close함수의 호출을 통해 연결을 종료하였다면, 그 이후부터는 A는 호스트 B가 송신하는 데이터를 수신하지 못한다.
  
  이 경우에 호스트A는 반드시 수신해야 할 데이터라 할지라도 그냥 소멸되고 만다.
  
  이런 문제의 해결을 위해 데이터의 송수신에 사용되는 스트림의 일부만 종료하는 방법이 있다. 
  
  이때 일부라는 것은 전송은 가능하지만 수신은 불가능한 상황 혹은 수신은 가능하지만 전송을 불가능한 상황처럼 스트림을 반만 닫는 것이다.
  
  
## 소켓과 스트림
  
  소켓을 통해 두 호스트가 연결되면 그 다음부터는 서로 데이터의 송수신이 가능한 상태가 된다.
  
  이런 상태를 스트림이 형성되었다고 하는데, 소켓의 스트림은 한쪽 방향으로만 데이터의 이동이 가능하기 때문에
  
  양방향 통신을 위해서는 두개의 스트림이 필요하다.
  
  한 쪽의 입력 스트림은 다른 쪽의 출력스트림으로 이어진다. 이 두개의 스트림 중 하나의 스트림만 끊는 것이 **Half-close** 이다.
  

## shutdown 함수
  
  리눅스의 close 함수와 윈도우의 closesocket 함수는 두 가지 스트림을 동시에 끊지만 shutdown 함수는 하나의 스트림만 종료시킨다.
  
  ```
  int shutdown(int sock, int howto); // 성공 시 0, 실패 시 -1 반환 
  ```
  
  howto에는 3가지 인자가 들어갈 수 있다.
  
  1. SHUT_RD  : 입력 스트림 종료
  2. SHUT_WR  : 출력 스트림 종료 
  3. SHUT_RDWR : 입출력 스트림 종료
  
  입력 스트림을 종료하면 버퍼에 데이터가 수신이 되어도 전부 사라지지만, 
  출력 스트림을 종료하면 출력 버퍼에 있던 데이터는 전송된다.
  
 
  
  

  


   
  



